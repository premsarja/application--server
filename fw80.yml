- name: Open ports using iptables
  hosts: all
  become: yes
  tasks:

    - name: add iptables rules
      shell: | 
        X="# Generated by iptables-save v1.8.8 (nf_tables) on Fri Nov 24 09:58:13 2023
          *filter
          :INPUT ACCEPT [202:50973]
          :FORWARD ACCEPT [0:0]
          :OUTPUT ACCEPT [2682:491485]
          -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
          -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
          -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
          COMMIT
          # Completed on Fri Nov 24 09:58:13 2023
        "
        echo "$X" > iptables  
        iptables-restore < iptables